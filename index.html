<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acibadem Office Map v2.6 (Modular AI)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { padding: 10px 20px; background-color: #f8f8ff; border-bottom: 1px solid #ddd; z-index: 1000; display: flex; align-items: center; flex-wrap: wrap; gap: 20px; }
        .header h1 { margin: 0; font-size: 1.5em; flex-grow: 1; }
        label { font-weight: bold; margin-right: 5px; }
        select { padding: 8px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; }
        #map { flex-grow: 1; border-top: 1px solid #ccc; background-color: #f0f0f0; }
        .custom-div-icon { background-color: #004b87; border-radius: 50%; width: 38px; height: 38px; display: flex; justify-content: center; align-items: center; box-shadow: 0 0 5px rgba(0,0,0,0.3); transition: transform 0.2s ease-in-out; cursor: pointer; }
        .custom-div-icon:hover { transform: scale(1.1); }
        .custom-div-icon img { width: 70%; height: 70%; }
        .marker-cluster div { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; font-size: 14px; color: white; font-weight: bold; }
        .marker-cluster-small { background-color: #1f78b4; }
        .marker-cluster-medium { background-color: #005a9c; }
        .marker-cluster-large { background-color: #004b87; }
        
        #sidebar { position: fixed; right: -350px; top: 0; width: 320px; height: 100%; background: white; z-index: 2000; box-shadow: -2px 0 8px rgba(0,0,0,0.2); transition: right 0.3s ease-in-out; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        #sidebar.open { right: 0; }
        #sidebar h2 { margin-top: 0; font-size: 1.2em; color: #004b87; }
        #sidebar p { line-height: 1.6; }
        #sidebar .close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; border: none; background: none; color: #888; }

        .location-button, .ai-button { padding: 8px 12px; font-size: 1em; cursor: pointer; background-color: #005a9c; color: white; border: none; border-radius: 5px; transition: background-color 0.2s; }
        .location-button:hover, .ai-button:hover { background-color: #004b87; }
        .ai-button { background-color: #5a009c; margin-top: 10px; width: 100%;}
        .ai-button:hover { background-color: #4b0087; }
        .ai-button:disabled { background-color: #ccc; cursor: not-allowed; }
        #ai-results { margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; }
        #ai-results h3 { font-size: 1.1em; color: #004b87; }
        #ai-results ul { padding-left: 20px; }
        .loader { width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #005a9c; border-radius: 50%; animation: spin 1s linear infinite; margin: 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .leaflet-bar a.leaflet-control-home {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 -960 960 960' width='24'%3E%3Cpath d='M220-180h150v-250h220v250h150v-390L480-765 220-570v390Zm-60 60v-510l320-240 320 240v510H610v-250H350v250H160Zm320-353Z'/%3E%3C/svg%3E");
            background-size: 75%;
            background-position: center;
            background-repeat: no-repeat;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Company Office Locations</h1>
        <div class="filter-container">
            <label for="country-filter">Filter by Country:</label>
            <select id="country-filter"></select>
        </div>
        <button id="find-nearest-btn" class="location-button">üìç Find Nearest Office</button>
    </div>
    <div id="map"></div>
    <div id="sidebar">
        <button id="close-sidebar-btn" class="close-btn">&times;</button>
        <div id="sidebar-content"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    
<script>
    // --- SETTINGS ---
    const USE_SIDEBAR = 1; // Use sidebar (1) or classic popups (0)
    
    // YENƒ∞: AI Asistanƒ± mod√ºl√ºn√º a√ßƒ±p kapatma ayarƒ±
    const USE_AI_ASSISTANT = 1; // Use Gemini AI Travel Assistant (1) or disable it (0).
    // Not: Bu √∂zelliƒüin √ßalƒ±≈ümasƒ± i√ßin projenin Gemini API'ye eri≈üimi olan bir ortamda olmasƒ± gerekir.

    // --- DATA ---
    const officeList = [
        {"name":"Acibadem Information Office Algiers","country":"Algiers","phone":"+213(0) 661 89 80 69"}, {"name":"Acibadem Information Office Wien","country":"Austria","phone":"+43 1 522 62 77"}, {"name":"Acibadem Information Office Tirane","country":"Albania","phone":"+355 69 56 29 686"},
        {"name":"Acibadem Information Office Baku","country":"Azerbaijan","phone":"+994 12 595 96 81"}, {"name":"Acibadem Information Office Gence","country":"Azerbaijan","phone":"+994 22 255 07 06"}, {"name":"Acƒ±badem Information Office Brussels","country":"Belgium","phone":"+32 471 90 60 12"},
        {"name":"Acibadem Information Office Sarajevo","country":"Bosnia and Herzegovina","phone":"+387 332 230 13"}, {"name":"Acibadem Information Office Tuzla","country":"Bosnia and Herzegovina","phone":"+387 354 812 75"}, {"name":"Acibadem Information Office Burgas","country":"Bulgaria","phone":"+359 877 9 59040"},
        {"name":"Acibadem Information Office Sofia","country":"Bulgaria","phone":"+359 28511228"}, {"name":"Acibadem Information Office - Plovdiv","country":"Bulgaria","phone":"+359 (32) 207 666"}, {"name":"Acibadem Information Office - Plovdiv #2","country":"Bulgaria","phone":"+359 326 601 92"},
        {"name":"Acƒ±badem Information Office Abidjan","country":"Cote d'Ivoire","phone":"+225 0710011105"}, {"name":"Acƒ±badem Information Office Rijeka","country":"Croatia","phone":"+385 51 565 264"}, {"name":"Acƒ±badem Information Office Zagreb","country":"Croatia","phone":"+385 1 4242 430"},
        {"name":"Information Office Paris","country":"France","phone":"+33 9 53 22 88 89"}, {"name":"Acibadem Information Office Tbilisi","country":"Georgia","phone":"+995 322 158 500"}, {"name":"Acibadem Information Office Kutaisi","country":"Georgia","phone":"+995 431 258 500"},
        {"name":"Acibadem Information Office Batumi","country":"Georgia","phone":"+995 422 22 30 00"}, {"name":"Acƒ±badem Information Office Dusseldorf","country":"Germany","phone":"+49 157 365 635 04"}, {"name":"Acƒ±badem Information Office Berlin","country":"Germany","phone":"+49 157 833 433 07"},
        {"name":"Acibadem Information Office Dohuk","country":"Iraq","phone":"+964 750 827 8668"}, {"name":"Acibadem Information Office Erbil","country":"Iraq","phone":"+964 751 523 64 07"}, {"name":"Acibadem Information Office Tabriz","country":"Iran","phone":"+98 413 327 4484"},
        {"name":"Acibadem Information Office Almaty","country":"Kazakhstan","phone":"+7 778 638 22 00"}, {"name":"Acibadem Information Office Shymkent","country":"Kazakhstan","phone":"+7 70 15 505 944"}, {"name":"Acibadem Information Office Bishkek/Osh","country":"Kyrgyzstan","phone":"+996 702 000 252"},
        {"name":"Acibadem Information Office Prishtine","country":"Kosovo","phone":"+383 382 340 04"}, {"name":"Acibadem Information Office Sistina Hospital","country":"North Macedonia","phone":"+389 23099599"}, {"name":"Official Representative - Eman Khalaf","country":"Kuwait","phone":"+965 9933 6005"},
        {"name":"Acibadem Information Office Chisinau","country":"Moldova","phone":"+373 6 0999 144"}, {"name":"Acibadem Information Office Podgorica","country":"Montenegro","phone":"+382 688 804 06"}, {"name":"Acibadem Information Office Casablanca","country":"Morocco","phone":"+212 643-585598"},
        {"name":"Acibadem Information Office Bucharest","country":"Romania","phone":"+40 730 519 254"}, {"name":"Acibadem Information Office Ia≈üi","country":"Romania","phone":"+40 739 883 640"}, {"name":"Acibadem Information Office Cluj Napoca","country":"Romania","phone":"+40 264 701 754"},
        {"name":"Acibadem Information Office Constanta","country":"Romania","phone":"+40 241 660 888"}, {"name":"Acibadem Information Office Timisoara","country":"Romania","phone":"+40 356 401 089"}, {"name":"Acibadem Information Office Moscow","country":"Russia","phone":"+7 495 135 82 80"},
        {"name":"Acibadem Information Office Grozny","country":"Russia","phone":"+7 929 890 50 56"}, {"name":"Acibadem Information Office Kazan","country":"Russia","phone":"+7 (906) 111-19-10"}, {"name":"Acibadem Information Office Belgrad","country":"Serbia","phone":"+381 62 820 8151"},
        {"name":"Acibadem Information Office Nis","country":"Serbia","phone":"+381 60 33 99 315"}, {"name":"Acibadem Information Office Novi Sad","country":"Serbia","phone":"+381 21 270 53 13"}, {"name":"Acibadem Information Office Madrid","country":"Spain","phone":"+34 673 04 23 43"},
        {"name":"Acibadem Information Office Barcelona","country":"Spain","phone":"+34 930 256872"}, {"name":"Acibadem Information Office Uganda","country":"Uganda","phone":"+237 697 592 650"}, {"name":"Acibadem Information Office London","country":"United Kingdom","phone":"+44 207 323 6665"},
        {"name":"Acibadem Information Office Kiev","country":"Ukraine","phone":"+380 93 955 48 40"}, {"name":"Acibadem Information Office Lviv","country":"Ukraine","phone":"+380 322 61 09 09"}, {"name":"Acibadem Information Office Bukhara","country":"Uzbekistan","phone":"+998 553154 44"},
        {"name":"Acibadem Information Office Tashkent","country":"Uzbekistan","phone":"+998 951 445 445"}, {"name":"Acibadem Information Office Samarkand","country":"Uzbekistan","phone":"+998 66 234 41 71"}, {"name":"Acibadem Information Office Dushanbe","country":"Tajikistan","phone":"+992 (44) 650-1717"}, {"name":"Acibadem Information Office Yaounde/Cameroon","country":"Cameroon","phone":"+237 67 454 5888"}
    ];

    // --- GLOBAL VARIABLES ---
    let allOffices = [];
    let map;
    let markers;
    let customIcon;

    // --- DOM ELEMENTS ---
    const mapElement = document.getElementById('map');
    const countryFilter = document.getElementById('country-filter');
    const findNearestBtn = document.getElementById('find-nearest-btn');
    const sidebar = document.getElementById('sidebar');
    const sidebarContent = document.getElementById('sidebar-content');
    const closeSidebarBtn = document.getElementById('close-sidebar-btn');
    
    // --- MAIN FUNCTION ---
    function initializeApp() {
        try {
            allOffices = officeList.map(office => ({...office, ...getCityCoordinates(office.name, office.country) }));
            setupMap();
            setupFilters();
            setupEventListeners();
            displayMarkers(allOffices);
            if (markers.getLayers().length > 0) {
                map.fitBounds(markers.getBounds(), { padding: [50, 50] });
            }
        } catch (error) {
            console.error('Application failed to initialize:', error);
            mapElement.innerHTML = 'Could not load the map. Please try again later.';
        }
    }

    // --- SETUP FUNCTIONS ---
    function setupMap() {
        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri'
        });
        const baseMaps = { "Street Map": osmLayer, "Satellite View": satelliteLayer };
        
        map = L.map('map', { layers: [osmLayer] });
        L.control.layers(baseMaps).addTo(map);

        customIcon = L.divIcon({
            className: 'custom-div-icon', html: `<img src="https://www.acibadem.com.tr/assets/images/acibadem-saglik-grubu-76x76.png">`,
            iconSize: [38, 38], iconAnchor: [19, 38], popupAnchor: [0, -38]
        });

        markers = L.markerClusterGroup();

        L.Control.Home = L.Control.extend({
            onAdd: function(map) {
                const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                const btn = L.DomUtil.create('a', 'leaflet-control-home', container);
                btn.title = 'Show All Offices';
                btn.href = '#';
                btn.setAttribute('role', 'button');
                
                L.DomEvent.on(btn, 'click', L.DomEvent.stop).on(btn, 'click', function(ev){
                    countryFilter.value = 'All Countries';
                    if (markers.getLayers().length > 0) {
                        map.flyToBounds(markers.getBounds(), { padding: [50, 50], duration: 1 });
                    }
                }, this);
                
                return container;
            },
            onRemove: function(map) { /* Nothing to do */ }
        });

        L.control.home = function(opts) { return new L.Control.Home(opts); }
        L.control.home({ position: 'topleft' }).addTo(map);
    }

    function setupFilters() {
        const uniqueCountries = [...new Set(allOffices.map(o => o.country))].sort();
        const countries = ['All Countries', ...uniqueCountries];
        countryFilter.innerHTML = '';
        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.textContent = country;
            countryFilter.appendChild(option);
        });
    }

    function setupEventListeners() {
        countryFilter.addEventListener('change', () => {
            const selected = countryFilter.value;
            const filtered = selected === 'All Countries' ? allOffices : allOffices.filter(o => o.country === selected);
            displayMarkers(filtered);
            if (markers.getLayers().length > 0) {
                map.flyToBounds(markers.getBounds(), { padding: [50, 50], duration: 1 });
            }
        });
        findNearestBtn.addEventListener('click', findNearestOffice);
        closeSidebarBtn.addEventListener('click', () => sidebar.classList.remove('open'));
        map.on('click', () => sidebar.classList.remove('open'));
        sidebar.addEventListener('click', (e) => e.stopPropagation());
    }

    // --- FUNCTIONAL LOGIC ---
    function displayMarkers(officesToDisplay) {
        markers.clearLayers();
        const officesWithCoords = officesToDisplay.filter(o => o.lat && o.lng);
        
        officesWithCoords.forEach(office => {
            const marker = L.marker([office.lat, office.lng], { icon: customIcon });
            
            if (USE_SIDEBAR) {
                marker.on('click', () => {
                    updateSidebar(office);
                    sidebar.classList.add('open');
                });
            } else {
                const cleanPhone = office.phone.replace(/[^0-9+]/g, '');
                const popupContent = `<b>${office.name}</b><br>Country: ${office.country}<br>Phone: <a href="tel:${cleanPhone}">${office.phone}</a>`;
                marker.bindPopup(popupContent);
            }
            markers.addLayer(marker);
        });
        map.addLayer(markers);
    }

    function findNearestOffice() {
        if (!navigator.geolocation) {
            alert('Your browser does not support geolocation.');
            return;
        }
        findNearestBtn.textContent = 'Searching for location...';
        navigator.geolocation.getCurrentPosition(position => {
            const { latitude, longitude } = position.coords;
            let nearestOffice = null;
            let minDistance = Infinity;

            allOffices.filter(o => o.lat && o.lng).forEach(office => {
                const distance = getDistance(latitude, longitude, office.lat, office.lng);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestOffice = office;
                }
            });

            if (nearestOffice) {
                map.flyTo([nearestOffice.lat, nearestOffice.lng], 13, {duration: 1.5});
                if (USE_SIDEBAR) {
                    updateSidebar(nearestOffice);
                    sidebar.classList.add('open');
                } else {
                     alert(`The nearest office is: ${nearestOffice.name} (${minDistance.toFixed(1)} km)`);
                }
            }
            findNearestBtn.textContent = 'üìç Find Nearest Office';
        }, () => {
            alert('Could not get location. Please check your browser permissions.');
            findNearestBtn.textContent = 'üìç Find Nearest Office';
        });
    }

    function updateSidebar(office) {
        const cleanPhone = office.phone.replace(/[^0-9+]/g, '');
        let sidebarHTML = `
            <h2>${office.name}</h2>
            <p><strong>Country:</strong> ${office.country}</p>
            <p><strong>Phone:</strong> <a href="tel:${cleanPhone}">${office.phone}</a></p>
            <p><a href="https://www.google.com/maps/dir/?api=1&destination=${office.lat},${office.lng}" target="_blank">Get Directions</a></p>
        `;
        
        // AI Asistanƒ± mod√ºl√º aktif ise butonu ve sonu√ß div'ini ekle
        if (USE_AI_ASSISTANT) {
            sidebarHTML += `
                <button id="ai-travel-btn" class="ai-button">‚ú® Get AI Travel Tips</button>
                <div id="ai-results"></div>
            `;
        }

        sidebarContent.innerHTML = sidebarHTML;

        // AI Asistanƒ± mod√ºl√º aktif ise event listener'ƒ± ekle
        if (USE_AI_ASSISTANT) {
            document.getElementById('ai-travel-btn').addEventListener('click', () => getTravelTips(office));
        }
    }

    async function getTravelTips(office) {
        // Bu fonksiyon sadece USE_AI_ASSISTANT = 1 ise √ßaƒürƒ±lƒ±r
        const btn = document.getElementById('ai-travel-btn');
        const resultsDiv = document.getElementById('ai-results');
        btn.disabled = true;
        btn.textContent = 'Thinking...';
        resultsDiv.innerHTML = '<div class="loader"></div>';

        const city = office.name.split(',')[0].replace('Acibadem Information Office', '').replace('Acƒ±badem Information Office', '').trim();
        const country = office.country;

        const prompt = `You are a friendly and concise travel assistant. A business professional is visiting their company's office in ${city}, ${country}. Provide a short and helpful guide with the following sections:
- A brief, welcoming sentence about the city.
- Two essential business etiquette tips for ${country}.
- One recommendation for a good restaurant suitable for a business lunch near the city center.
Format the entire response using basic HTML tags like <h3>, <p>, and <ul><li>. Do not include <html> or <body> tags.`;

        try {
            const apiKey = "";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) { throw new Error(`API call failed with status: ${response.status}`); }
            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            resultsDiv.innerHTML = text;
        } catch (error) {
            console.error('Error fetching AI tips:', error);
            resultsDiv.innerHTML = '<p>Sorry, I could not fetch travel tips at the moment. Please try again later.</p>';
        } finally {
            btn.style.display = 'none';
        }
    }

    // --- HELPER FUNCTIONS ---
    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
    }

    function getCityCoordinates(name, country) {
        const cityCoordinates = { 'algiers':{lat:36.775,lng:3.06},'wien':{lat:48.208,lng:16.373},'tirane':{lat:41.327,lng:19.818},'baku':{lat:40.409,lng:49.867},'gence':{lat:40.682,lng:46.36},'brussels':{lat:50.85,lng:4.351},'sarajevo':{lat:43.856,lng:18.413},'tuzla':{lat:44.538,lng:18.675},'burgas':{lat:42.495,lng:27.471},'sofia':{lat:42.697,lng:23.321},'plovdiv':{lat:42.135,lng:24.745},'abidjan':{lat:5.36,lng:-4.008},'rijeka':{lat:45.327,lng:14.442},'zagreb':{lat:45.815,lng:15.981},'paris':{lat:48.856,lng:2.352},'tbilisi':{lat:41.715,lng:44.783},'kutaisi':{lat:42.251,lng:42.702},'batumi':{lat:41.642,lng:41.633},'dusseldorf':{lat:51.227,lng:6.773},'berlin':{lat:52.52,lng:13.405},'dohuk':{lat:36.864,lng:42.986},'erbil':{lat:36.191,lng:44.009},'tabriz':{lat:38.079,lng:46.289},'almaty':{lat:43.222,lng:76.851},'shymkent':{lat:42.321,lng:69.591},'bishkek':{lat:42.874,lng:74.569},'prishtine':{lat:42.662,lng:21.165},'sistina hospital':{lat:42.004,lng:21.409},'kuwait':{lat:29.375,lng:47.977},'chisinau':{lat:47.01,lng:28.863},'podgorica':{lat:42.43,lng:19.259},'casablanca':{lat:33.573,lng:-7.589},'bucharest':{lat:44.426,lng:26.102},'ia≈üi':{lat:47.158,lng:27.601},'cluj napoca':{lat:46.771,lng:23.623},'constanta':{lat:44.182,lng:28.634},'timisoara':{lat:45.748,lng:21.208},'moscow':{lat:55.755,lng:37.617},'grozny':{lat:43.316,lng:45.698},'kazan':{lat:55.796,lng:49.106},'belgrad':{lat:44.786,lng:20.448},'nis':{lat:43.32,lng:21.895},'novi sad':{lat:45.267,lng:19.833},'madrid':{lat:40.416,lng:-3.703},'barcelona':{lat:41.385,lng:2.173},'uganda':{lat:1.373,lng:32.29},'london':{lat:51.507,lng:-0.127},'kiev':{lat:50.45,lng:30.523},'lviv':{lat:49.839,lng:24.029},'bukhara':{lat:39.768,lng:64.455},'tashkent':{lat:41.299,lng:69.24},'samarkand':{lat:39.654,lng:66.975},'dushanbe':{lat:38.559,lng:68.787},'yaounde':{lat:3.848,lng:11.502} };
        const lowerCaseName = name.toLowerCase();
        for (const city in cityCoordinates) { if (lowerCaseName.includes(city)) return cityCoordinates[city]; }
        if (country.toLowerCase() === 'kuwait') return cityCoordinates['kuwait'];
        return { lat: null, lng: null };
    }
    
    // --- INITIALIZE APP ---
    document.addEventListener('DOMContentLoaded', initializeApp);

</script>
</body>
</html>

